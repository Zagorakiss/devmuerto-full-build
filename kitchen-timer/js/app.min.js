function renderTime(){$tl.css("transform","translateX(-"+pixelPos+"px)"),$tl.css("-ms-transform","translateX(-"+pixelPos+"px)"),$tl.css("-moz-transform","translateX(-"+pixelPos+"px)"),$tl.css("-webkit-transform","translateX(-"+pixelPos+"px)")}function doTick(){setTimeout(doTick,10);var e=Date.now()-lastTick;return lastTick=Date.now(),isDragging||0>=timePos?void(isTickPlaying&&(tickSound.stop(),isTickPlaying=!1)):(isTickPlaying||(tickSound.play(),isTickPlaying=!0),timePos-=e,timePos=Math.max(0,Math.min(timePos,secondsWidth*timeMultiplier)),pixelPos=timePos/secondsWidth*pixelWidth/timeMultiplier,renderTime(),void(0==timePos&&(wiggle($(".main")),ringSound.stop().play())))}function wiggle(e){TweenMax.fromTo(e,.07,{x:-4},{x:4,ease:Power1.easeInOut,yoyo:!0,repeat:21,onCompleteParams:[e],onComplete:resetWiggle})}function resetWiggle(e){TweenMax.to(e,.05,{x:0,ease:Power1.easeInOut})}var $tl=$("#timeline"),$tm=$(".tomato"),isDragging=!1,oldPosX=0,pixelPos=0,timePos=0,pixelWidth=630,secondsWidth=25,timeMultiplier=6e4,tickSound=new Howl({urls:["assets/pomodoro_tick.ogg","assets/pomodoro_tick.mp3"],loop:!0,volume:.5}),turnSound=new Howl({urls:["assets/pomodoro_turn.ogg","assets/pomodoro_turn.mp3"]}),isTickPlaying=!1,turnSoundDist=12.5,ringSound=new Howl({urls:["assets/pomodoro_ring.ogg","assets/pomodoro_ring.mp3"],volume:1});$tm.mousedown(function(e){e.preventDefault(),isDragging=!0});var lastTurnPos=0;$(document).mousemove(function(e){if(e.preventDefault(),isDragging){var o=e.pageX-oldPosX;pixelPos-=o,pixelPos=Math.max(0,Math.min(pixelPos,pixelWidth)),timePos=Math.ceil(pixelPos*secondsWidth/pixelWidth*timeMultiplier),renderTime(),o>0&&(lastTurnPos=e.pageX),e.pageX-lastTurnPos<-turnSoundDist&&(pixelWidth>pixelPos&&turnSound.play(),lastTurnPos=e.pageX)}else lastTurnPos=e.pageX;oldPosX=e.pageX}).mouseup(function(e){isDragging=!1});var lastTick=Date.now();doTick(),$(".sound").click(function(e){e.preventDefault(),$(this).hasClass("mute")?($(this).removeClass("mute"),tickSound.volume(.5)):($(this).addClass("mute"),tickSound.volume(0))});
